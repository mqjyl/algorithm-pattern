# lambdaè¡¨è¾¾å¼

åŒ¿åå‡½æ•°æœ‰å‡½æ•°ä½“ï¼Œä½†æ²¡æœ‰å‡½æ•°åã€‚åŒ¿åå‡½æ•°æ˜¯å¾ˆå¤šé«˜çº§è¯­è¨€éƒ½æ”¯æŒçš„æ¦‚å¿µï¼Œå¦‚lispè¯­è¨€åœ¨1958å¹´é¦–å…ˆé‡‡ç”¨åŒ¿åå‡½æ•°ã€‚C++11ä¸­å¼•å…¥äº†lambdaå‡½æ•°ã€‚åˆ©ç”¨`lambda`è¡¨è¾¾å¼å¯ä»¥ç¼–å†™å†…åµŒçš„åŒ¿åå‡½æ•°ï¼Œç”¨ä»¥æ›¿æ¢ç‹¬ç«‹å‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ä»£ç æ›´å¯è¯»ã€‚ä½†æ˜¯ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œ`lambda`è¡¨è¾¾å¼åªæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå› ä¸ºæ‰€æœ‰å…¶èƒ½å®Œæˆçš„å·¥ä½œéƒ½å¯ä»¥ç”¨å…¶å®ƒç¨å¾®å¤æ‚çš„ä»£ç æ¥å®ç°ã€‚ä½†æ˜¯å®ƒç®€ä¾¿çš„è¯­æ³•å´ç»™`C++`å¸¦æ¥äº†æ·±è¿œçš„å½±å“ã€‚å¦‚æœä»å¹¿ä¹‰ä¸Šè¯´ï¼Œ`lamdba`è¡¨è¾¾å¼äº§ç”Ÿçš„æ˜¯å‡½æ•°å¯¹è±¡ã€‚

> ç›¸åŒç±»ä¼¼åŠŸèƒ½æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨**å‡½æ•°å¯¹è±¡**æˆ–è€…**å‡½æ•°æŒ‡é’ˆ**å®ç°ï¼šå‡½æ•°å¯¹è±¡èƒ½ç»´æŠ¤çŠ¶æ€ï¼Œä½†è¯­æ³•å¼€é”€å¤§ï¼Œè€Œå‡½æ•°æŒ‡é’ˆè¯­æ³•å¼€é”€å°ï¼Œå´æ²¡æ³•ä¿å­˜èŒƒå›´å†…çš„çŠ¶æ€ã€‚lambdaè¡¨è¾¾å¼æ­£æ˜¯ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ã€‚

## âœ 1ã€Lambdaè¡¨è¾¾å¼

### ğŸ–‹ 1.1ã€å£°æ˜Lambdaè¡¨è¾¾å¼

```cpp
[capture list] (params list) mutable exception -> return type { function body };
[capture list] (params list) -> return type {function body};  //1
[capture list] (params list) {function body};		//2
[capture list] {function body};		//3
```

* capture listï¼šæ•è·å¤–éƒ¨å˜é‡åˆ—è¡¨
* params listï¼šå½¢å‚åˆ—è¡¨
* mutableæŒ‡ç¤ºç¬¦ï¼šç”¨æ¥è¯´ç”¨æ˜¯å¦å¯ä»¥ä¿®æ”¹æ•è·çš„å˜é‡
* exceptionï¼šå¼‚å¸¸è®¾å®š
* return typeï¼šè¿”å›ç±»å‹
* function bodyï¼šå‡½æ•°ä½“

æ ‡å·1. å‡½æ•°å£°æ˜äº†ä¸€ä¸ªconstç±»å‹çš„è¡¨è¾¾å¼ï¼Œæ­¤å£°æ˜ä¸å¯æ”¹å˜capture listä¸­çš„æ•è·çš„å€¼ã€‚

æ ‡å·2. å‡½æ•°çœç•¥äº†è¿”å›å€¼ï¼Œæ­¤æ—¶å¦‚æœfunction bodyå†…å«æœ‰returnè¯­å¥ï¼Œåˆ™æŒ‰returnè¯­å¥è¿”å›ç±»å‹å†³å®šè¿”å›å€¼ç±»å‹ï¼Œè‹¥æ— åˆ™è¿”å›å€¼ä¸ºvoidç±»å‹ã€‚

æ ‡å·3. å‡½æ•°æ— å‚æ•°åˆ—è¡¨ï¼Œæ„å‘³æ— å‚å‡½æ•°ã€‚

```cpp
vector<int> vec{1,0,9,5,3,3,7,8,2};
sort(lbvec.begin(), lbvec.end(), [](int a, int b) -> bool { return a < b; });  
```

### ğŸ–‹ 1.2ã€æ•è·å¤–éƒ¨å˜é‡

`lambda`è¡¨è¾¾å¼æœ€å‰é¢çš„æ–¹æ‹¬å·çš„æ„ä¹‰ä½•åœ¨ï¼Ÿå…¶å®è¿™æ˜¯`lambda`è¡¨è¾¾å¼ä¸€ä¸ªå¾ˆHongè¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯é—­åŒ…ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè®²ä¸€ä¸‹`lambda`è¡¨è¾¾å¼çš„å¤§è‡´åŸç†ï¼šæ¯å½“ä½ å®šä¹‰ä¸€ä¸ª`lambda`è¡¨è¾¾å¼åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ¿åç±»ï¼ˆè¿™ä¸ªç±»å½“ç„¶é‡è½½äº†`()`è¿ç®—ç¬¦ï¼‰ï¼Œæˆ‘ä»¬ç§°ä¸ºé—­åŒ…ç±»å‹ï¼ˆclosure typeï¼‰ã€‚é‚£ä¹ˆåœ¨è¿è¡Œæ—¶ï¼Œè¿™ä¸ª`lambda`è¡¨è¾¾å¼å°±ä¼šè¿”å›ä¸€ä¸ªåŒ¿åçš„é—­åŒ…å®ä¾‹ï¼Œå…¶å®ä¸€ä¸ªå³å€¼ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸Šé¢çš„`lambda`è¡¨è¾¾å¼çš„ç»“æœå°±æ˜¯ä¸€ä¸ªä¸ªé—­åŒ…ã€‚é—­åŒ…çš„ä¸€ä¸ªå¼ºå¤§ä¹‹å¤„æ˜¯å…¶å¯ä»¥é€šè¿‡ä¼ å€¼æˆ–è€…å¼•ç”¨çš„æ–¹å¼æ•æ‰**å…¶å°è£…ä½œç”¨åŸŸå†…çš„å˜é‡**ï¼Œå‰é¢çš„æ–¹æ‹¬å·å°±æ˜¯ç”¨æ¥å®šä¹‰æ•æ‰æ¨¡å¼ä»¥åŠå˜é‡ï¼Œæˆ‘ä»¬åˆå°†å…¶ç§°ä¸º`lambda`æ•æ‰å—ã€‚

Lambdaè¡¨è¾¾å¼å¯ä»¥æ•è·å¤–é¢å˜é‡ï¼Œä½†éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªè°“è¯å‡½æ•°ï¼ˆ\[capture list\]åœ¨å£°æ˜è¡¨è¾¾å¼æœ€å‰ï¼‰ã€‚ç±»ä¼¼å‚æ•°ä¼ é€’æ–¹å¼ï¼šå€¼ä¼ é€’ã€å¼•å…¥ä¼ é€’ã€æŒ‡é’ˆä¼ é€’ã€‚åœ¨Lambdaè¡¨è¾¾å¼ä¸­ï¼Œå¤–éƒ¨å˜é‡æ•è·æ–¹å¼ä¹Ÿç±»ä¼¼ï¼š**å€¼æ•è·ã€å¼•ç”¨æ•è·ã€éšå¼æ•è·**ã€‚

#### å€¼æ•è·

```cpp
int a = 123;
auto f = [a] { cout << a << endl; }; 
f(); // è¾“å‡ºï¼š123
a = 321;
f(); // è¾“å‡ºï¼š123
```

å€¼æ•è·å’Œå‚æ•°ä¼ é€’ä¸­çš„**å€¼ä¼ é€’**ç±»ä¼¼ï¼Œè¢«æ•è·çš„å€¼åœ¨Lambdaè¡¨è¾¾å¼åˆ›å»ºæ—¶é€šè¿‡**å€¼æ‹·è´**çš„æ–¹å¼ä¼ å…¥ï¼Œå› æ­¤**Lambdaè¡¨è¾¾å¼å‡½æ•°ä½“ä¸­ä¸èƒ½ä¿®æ”¹è¯¥å¤–éƒ¨å˜é‡çš„å€¼**ï¼›åŒæ ·ï¼Œå‡½æ•°ä½“å¤–å¯¹äºå€¼çš„ä¿®æ”¹ä¹Ÿä¸ä¼šæ”¹å˜è¢«æ•è·çš„å€¼ã€‚

#### å¼•ç”¨æ•è·

```cpp
int a = 123;
auto f = [&a] { cout << a << endl; }; 
a = 321;
f(); // è¾“å‡ºï¼š321
```

å¼•ç”¨æ•è·çš„å˜é‡ä½¿ç”¨çš„å®é™…ä¸Šå°±æ˜¯è¯¥å¼•ç”¨æ‰€ç»‘å®šçš„å¯¹è±¡ï¼Œå› æ­¤å¼•ç”¨å¯¹è±¡çš„æ”¹å˜ä¼šæ”¹å˜å‡½æ•°ä½“å†…å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨çš„å€¼ã€‚

#### éšå¼æ•è·

éšå¼æ•è·æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯  
\[=\]ï¼šä»¥å€¼è¡¥è·çš„æ–¹å¼æ•è·å¤–éƒ¨**æ‰€æœ‰å˜é‡**  
\[&\]ï¼šè¡¨ç¤ºä»¥å¼•ç”¨æ•è·çš„æ–¹å¼æ•è·å¤–éƒ¨**æ‰€æœ‰å˜é‡**ã€‚

```cpp
int a = 123, b=321;
auto df = [=] { cout << a << b << endl; };    // å€¼æ•è·
auto rf = [&] { cout << a << b << endl; };    // å¼•ç”¨æ•è·
```

#### å…¶ä»–æ•è·æ–¹å¼

| æ•è·å¤–éƒ¨å˜é‡å½¢å¼ |  |
| :--- | :--- |
| \[ \] | ä¸æ•è·ä»»ä½•å˜é‡ï¼ˆæ— å‚å‡½æ•°ï¼‰ |
| \[å˜é‡1,&å˜é‡2, â€¦\] | å€¼\(å¼•ç”¨\)å½¢å¼æ•è·æŒ‡å®šçš„å¤šä¸ªå¤–éƒ¨å˜é‡ |
| \[this\] | å€¼æ•è·thisæŒ‡é’ˆ |
| \[=, &x\] | å˜é‡xä»¥å¼•ç”¨å½¢å¼æ•è·ï¼Œå…¶ä½™å˜é‡ä»¥ä¼ å€¼å½¢å¼æ•è· |
| \[\*this\] | é€šè¿‡ä¼ å€¼æ–¹å¼æ•è·å½“å‰å¯¹è±¡ |
| \[&, x\] | é»˜è®¤ä»¥å¼•ç”¨æ•è·æ‰€æœ‰å˜é‡ï¼Œä½†æ˜¯xæ˜¯ä¾‹å¤–ï¼Œé€šè¿‡å€¼æ•è· |

### ğŸ–‹ 1.3ã€å‚æ•°

* å‚æ•°åˆ—è¡¨ä¸­ä¸èƒ½æœ‰é»˜è®¤å‚æ•°
* ä¸æ”¯æŒå¯å˜å‚æ•°
* æ‰€æœ‰å‚æ•°å¿…é¡»æœ‰å‚æ•°å

### ğŸ–‹ 1.4ã€mutable

 å°†`lambda`è¡¨è¾¾å¼æ ‡è®°ä¸º`mutable`ï¼Œå®ç°çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦æ˜¯éconstå±æ€§çš„ã€‚å¯¹äºå¼•ç”¨æ•è·æ–¹å¼ï¼Œæ— è®ºæ˜¯å¦æ ‡è®°`mutable`ï¼Œéƒ½å¯ä»¥åœ¨`lambda`è¡¨è¾¾å¼ä¸­ä¿®æ”¹æ•è·çš„å€¼ã€‚è‡³äºé—­åŒ…ç±»ä¸­æ˜¯å¦æœ‰å¯¹åº”æˆå‘˜ï¼Œ`C++`æ ‡å‡†ä¸­ç»™å‡ºçš„ç­”æ¡ˆæ˜¯ï¼šä¸æ¸…æ¥šçš„ï¼Œçœ‹æ¥ä¸å…·ä½“å®ç°æœ‰å…³ã€‚æ—¢ç„¶è¯´åˆ°äº†æ·±å¤„ï¼Œè¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼š`lambda`è¡¨è¾¾å¼æ˜¯ä¸èƒ½è¢«èµ‹å€¼çš„ï¼š  


