# lambdaè¡¨è¾¾å¼

åŒ¿åå‡½æ•°æ˜¯å¾ˆå¤šé«˜çº§è¯­è¨€éƒ½æ”¯æŒçš„æ¦‚å¿µï¼Œå¦‚lispè¯­è¨€åœ¨1958å¹´é¦–å…ˆé‡‡ç”¨åŒ¿åå‡½æ•°ã€‚åŒ¿åå‡½æ•°æœ‰å‡½æ•°ä½“ï¼Œä½†æ²¡æœ‰å‡½æ•°åã€‚C++11ä¸­å¼•å…¥äº†lambdaè¡¨è¾¾å¼ã€‚åˆ©ç”¨`lambda`è¡¨è¾¾å¼å¯ä»¥ç¼–å†™å†…åµŒçš„åŒ¿åå‡½æ•°ï¼Œç”¨ä»¥æ›¿æ¢ç‹¬ç«‹å‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ä»£ç æ›´å¯è¯»ã€‚ä½†æ˜¯ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œ`lambda`è¡¨è¾¾å¼åªæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå› ä¸ºæ‰€æœ‰å…¶èƒ½å®Œæˆçš„å·¥ä½œéƒ½å¯ä»¥ç”¨å…¶å®ƒç¨å¾®å¤æ‚çš„ä»£ç æ¥å®ç°ã€‚ä½†æ˜¯å®ƒç®€ä¾¿çš„è¯­æ³•å´ç»™`C++`å¸¦æ¥äº†æ·±è¿œçš„å½±å“ã€‚å¦‚æœä»å¹¿ä¹‰ä¸Šè¯´ï¼Œ`lamdba`è¡¨è¾¾å¼äº§ç”Ÿçš„æ˜¯å‡½æ•°å¯¹è±¡ã€‚

> ç›¸åŒç±»ä¼¼åŠŸèƒ½æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨**å‡½æ•°å¯¹è±¡**æˆ–è€…**å‡½æ•°æŒ‡é’ˆ**å®ç°ï¼šå‡½æ•°å¯¹è±¡èƒ½ç»´æŠ¤çŠ¶æ€ï¼Œä½†è¯­æ³•å¼€é”€å¤§ï¼Œè€Œå‡½æ•°æŒ‡é’ˆè¯­æ³•å¼€é”€å°ï¼Œå´æ²¡æ³•ä¿å­˜èŒƒå›´å†…çš„çŠ¶æ€ã€‚lambdaè¡¨è¾¾å¼æ­£æ˜¯ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ã€‚

## âœ 1ã€Lambdaè¡¨è¾¾å¼

### ğŸ–‹ 1.1ã€å£°æ˜Lambdaè¡¨è¾¾å¼

```cpp
// å®Œæ•´è¯­æ³•
[capture list] (params list) mutable(optional) constexpr(optional)(c++17) exception attribute -> return type { function body };

// å¯é€‰çš„ç®€åŒ–è¯­æ³•
[capture list] (params list) -> return type {function body};  //1
[capture list] (params list) {function body};		//2
[capture list] {function body};		//3
```

* capture listï¼šæ•è·å¤–éƒ¨å˜é‡åˆ—è¡¨ï¼Œä¸èƒ½çœç•¥ï¼›
* params listï¼šå½¢å‚åˆ—è¡¨ï¼Œå¯ä»¥çœç•¥ï¼ˆä½†æ˜¯åé¢å¿…é¡»ç´§è·Ÿå‡½æ•°ä½“ï¼‰ï¼›
* mutableæŒ‡ç¤ºç¬¦ï¼š å¯é€‰ï¼Œå°†`lambda`è¡¨è¾¾å¼æ ‡è®°ä¸º`mutable`åï¼Œå‡½æ•°ä½“å°±å¯ä»¥ä¿®æ”¹ä¼ å€¼æ–¹å¼æ•è·çš„å˜é‡ï¼›
* constexprï¼šå¯é€‰ï¼ŒC++17ï¼Œå¯ä»¥æŒ‡å®š`lambda`è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¸¸é‡å‡½æ•°ï¼›
* exceptionï¼šå¼‚å¸¸è®¾å®šï¼Œ å¯é€‰ï¼ŒæŒ‡å®š`lambda`è¡¨è¾¾å¼å¯ä»¥æŠ›å‡ºçš„å¼‚å¸¸ï¼›
* attributeï¼šå¯é€‰ï¼ŒæŒ‡å®š`lambda`è¡¨è¾¾å¼çš„ç‰¹æ€§ï¼›
* return typeï¼šè¿”å›ç±»å‹
* function bodyï¼šå‡½æ•°ä½“

æ ‡å·1. å‡½æ•°å£°æ˜äº†ä¸€ä¸ªconstç±»å‹çš„è¡¨è¾¾å¼ï¼Œæ­¤å£°æ˜ä¸å¯æ”¹å˜capture listä¸­çš„æ•è·çš„å€¼ã€‚

æ ‡å·2. å‡½æ•°çœç•¥äº†è¿”å›å€¼ï¼Œæ­¤æ—¶å¦‚æœfunction bodyå†…å«æœ‰returnè¯­å¥ï¼Œåˆ™æŒ‰returnè¯­å¥è¿”å›ç±»å‹å†³å®šè¿”å›å€¼ç±»å‹ï¼Œè‹¥æ— åˆ™è¿”å›å€¼ä¸ºvoidç±»å‹ã€‚

æ ‡å·3. å‡½æ•°æ— å‚æ•°åˆ—è¡¨ï¼Œæ„å‘³æ— å‚å‡½æ•°ã€‚

```cpp
vector<int> vec{1,0,9,5,3,3,7,8,2};

sort(lbvec.begin(), lbvec.end(), [](int a, int b) -> bool { return a < b; });  
```

### ğŸ–‹ 1.2ã€æ•è·å¤–éƒ¨å˜é‡

`lambda`è¡¨è¾¾å¼æœ€å‰é¢çš„æ–¹æ‹¬å·çš„æ„ä¹‰ä½•åœ¨ï¼Ÿå…¶å®è¿™æ˜¯`lambda`è¡¨è¾¾å¼ä¸€ä¸ªå¾ˆHongè¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯é—­åŒ…ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè®²ä¸€ä¸‹`lambda`è¡¨è¾¾å¼çš„å¤§è‡´åŸç†ï¼šæ¯å½“ä½ å®šä¹‰ä¸€ä¸ª`lambda`è¡¨è¾¾å¼åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ¿åç±»ï¼ˆè¿™ä¸ªç±»å½“ç„¶é‡è½½äº†`()`è¿ç®—ç¬¦ï¼‰ï¼Œæˆ‘ä»¬ç§°ä¸ºé—­åŒ…ç±»å‹ï¼ˆclosure typeï¼‰ã€‚é‚£ä¹ˆåœ¨è¿è¡Œæ—¶ï¼Œè¿™ä¸ª`lambda`è¡¨è¾¾å¼å°±ä¼šè¿”å›ä¸€ä¸ª**åŒ¿åçš„é—­åŒ…å®ä¾‹**ï¼Œå…¶å®ä¸€ä¸ªå³å€¼ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸Šé¢çš„`lambda`è¡¨è¾¾å¼çš„ç»“æœå°±æ˜¯ä¸€ä¸ªä¸ªé—­åŒ…ã€‚é—­åŒ…çš„ä¸€ä¸ªå¼ºå¤§ä¹‹å¤„æ˜¯å…¶å¯ä»¥é€šè¿‡ä¼ å€¼æˆ–è€…å¼•ç”¨çš„æ–¹å¼æ•æ‰**å…¶å°è£…ä½œç”¨åŸŸå†…çš„å˜é‡**ï¼Œå‰é¢çš„æ–¹æ‹¬å·å°±æ˜¯ç”¨æ¥å®šä¹‰æ•æ‰æ¨¡å¼ä»¥åŠå˜é‡ï¼Œæˆ‘ä»¬åˆå°†å…¶ç§°ä¸º`lambda`æ•æ‰å—ã€‚

Lambdaè¡¨è¾¾å¼å¯ä»¥æ•è·å¤–é¢å˜é‡ï¼Œä½†éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªè°“è¯å‡½æ•°ï¼ˆ\[capture list\]åœ¨å£°æ˜è¡¨è¾¾å¼æœ€å‰ï¼‰ã€‚ç±»ä¼¼å‚æ•°ä¼ é€’æ–¹å¼ï¼šå€¼ä¼ é€’ã€å¼•å…¥ä¼ é€’ã€æŒ‡é’ˆä¼ é€’ã€‚åœ¨Lambdaè¡¨è¾¾å¼ä¸­ï¼Œå¤–éƒ¨å˜é‡æ•è·æ–¹å¼ä¹Ÿç±»ä¼¼ï¼š**å€¼æ•è·ã€å¼•ç”¨æ•è·ã€éšå¼æ•è·**ã€‚

#### å€¼æ•è·

```cpp
int a = 123;
auto f = [a] { cout << a << endl; }; 
f(); // è¾“å‡ºï¼š123
a = 321;
f(); // è¾“å‡ºï¼š123
```

å€¼æ•è·å’Œå‚æ•°ä¼ é€’ä¸­çš„**å€¼ä¼ é€’**ç±»ä¼¼ï¼Œè¢«æ•è·çš„å€¼åœ¨Lambdaè¡¨è¾¾å¼åˆ›å»ºæ—¶é€šè¿‡**å€¼æ‹·è´**çš„æ–¹å¼ä¼ å…¥ï¼Œç±»ä¸­ä¼šç›¸åº”æ·»åŠ å¯¹åº”ç±»å‹çš„éé™æ€æ•°æ®æˆå‘˜ã€‚åœ¨è¿è¡Œæ—¶ï¼Œä¼šç”¨å¤åˆ¶çš„å€¼åˆå§‹åŒ–è¿™äº›æˆå‘˜å˜é‡ï¼Œä»è€Œç”Ÿæˆé—­åŒ…ã€‚å› æ­¤**Lambdaè¡¨è¾¾å¼å‡½æ•°ä½“ä¸­ä¸èƒ½ä¿®æ”¹è¯¥å¤–éƒ¨å˜é‡çš„å€¼**ï¼› å› ä¸ºå‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„é‡è½½æ–¹æ³•æ˜¯`const`å±æ€§çš„ã€‚åŒæ ·ï¼Œå‡½æ•°ä½“å¤–å¯¹äºå€¼çš„ä¿®æ”¹ä¹Ÿä¸ä¼šæ”¹å˜è¢«æ•è·çš„å€¼ã€‚ æƒ³æ”¹åŠ¨ä¼ å€¼æ–¹å¼æ•è·çš„å€¼ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨`mutable`ã€‚

```cpp
auto add_x = [x](int a) mutable { x *= 2; return a + x; };  // å¤åˆ¶æ•æ‰x
    
cout << add_x(10) << endl; // è¾“å‡ºï¼š30
```

 å› ä¸ºä¸€æ—¦å°†`lambda`è¡¨è¾¾å¼æ ‡è®°ä¸º`mutable`ï¼Œé‚£ä¹ˆå®ç°çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦æ˜¯éconstå±æ€§çš„ã€‚

#### å¼•ç”¨æ•è·

```cpp
int a = 123;
auto f = [&a] { cout << a << endl; }; 
a = 321;
f(); // è¾“å‡ºï¼š321
```

å¼•ç”¨æ•è·çš„å˜é‡ä½¿ç”¨çš„å®é™…ä¸Šå°±æ˜¯è¯¥å¼•ç”¨æ‰€ç»‘å®šçš„å¯¹è±¡ï¼Œå› æ­¤å¼•ç”¨å¯¹è±¡çš„æ”¹å˜ä¼šæ”¹å˜å‡½æ•°ä½“å†…å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨çš„å€¼ã€‚ å¯¹äºå¼•ç”¨æ•è·æ–¹å¼ï¼Œæ— è®ºæ˜¯å¦æ ‡è®°`mutable`ï¼Œéƒ½å¯ä»¥åœ¨`lambda`è¡¨è¾¾å¼ä¸­ä¿®æ”¹æ•è·çš„å€¼ã€‚

#### éšå¼æ•è·

éšå¼æ•è·æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯  
\[=\]ï¼šä»¥å€¼è¡¥è·çš„æ–¹å¼æ•è·å¤–éƒ¨**æ‰€æœ‰å˜é‡**  
\[&\]ï¼šè¡¨ç¤ºä»¥å¼•ç”¨æ•è·çš„æ–¹å¼æ•è·å¤–éƒ¨**æ‰€æœ‰å˜é‡**ã€‚

```cpp
int a = 123, b=321;
auto df = [=] { cout << a << b << endl; };    // å€¼æ•è·
auto rf = [&] { cout << a << b << endl; };    // å¼•ç”¨æ•è·
```

#### å…¶ä»–æ•è·æ–¹å¼

| æ•è·å¤–éƒ¨å˜é‡å½¢å¼ |  |
| :--- | :--- |
| \[ \] | ä¸æ•è·ä»»ä½•å˜é‡ï¼ˆæ— å‚å‡½æ•°ï¼‰ |
| \[å˜é‡1,&å˜é‡2, â€¦\] | å€¼\(å¼•ç”¨\)å½¢å¼æ•è·æŒ‡å®šçš„å¤šä¸ªå¤–éƒ¨å˜é‡ |
| \[this\] | å€¼æ•è·thisæŒ‡é’ˆ |
| \[=, &x\] | å˜é‡xä»¥å¼•ç”¨å½¢å¼æ•è·ï¼Œå…¶ä½™å˜é‡ä»¥ä¼ å€¼å½¢å¼æ•è· |
| \[\*this\] | é€šè¿‡ä¼ å€¼æ–¹å¼æ•è·å½“å‰å¯¹è±¡ |
| \[&, x\] | é»˜è®¤ä»¥å¼•ç”¨æ•è·æ‰€æœ‰å˜é‡ï¼Œä½†æ˜¯xæ˜¯ä¾‹å¤–ï¼Œé€šè¿‡å€¼æ•è· |

> æ—¢ç„¶åªä½¿ç”¨ä¸€æ¬¡ï¼Œé‚£ç›´æ¥å†™å…¨ä»£ç ä¸ä¹…é†’äº†ï¼Œä¸ºå•¥è¦å‡½æ•°å‘¢ï¼Ÿâ€”â€”å› ä¸ºlambdaå¯ä»¥æ•è·å±€éƒ¨å˜é‡

åœ¨ä¸Šé¢çš„æ•è·æ–¹å¼ä¸­ï¼Œæ³¨æ„æœ€å¥½ä¸è¦ä½¿ç”¨`[=]`å’Œ`[&]`é»˜è®¤æ•è·æ‰€æœ‰å˜é‡ã€‚é¦–å…ˆè¯´é»˜è®¤å¼•ç”¨æ•è·æ‰€æœ‰å˜é‡ï¼Œä½ æœ‰å¾ˆå¤§å¯èƒ½ä¼šå‡ºç°æ‚¬æŒ‚å¼•ç”¨ï¼ˆDangling referencesï¼‰ï¼Œå› ä¸ºå¼•ç”¨æ•è·ä¸ä¼šå»¶é•¿å¼•ç”¨çš„å˜é‡çš„å£°æ˜å‘¨æœŸï¼š

```cpp
std::function<int(int)> add_x(int x)
{
    return [&](int a) { return x + a; };
}
```

å› ä¸ºå‚æ•°`x`ä»…æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œå‡½æ•°è°ƒç”¨åå°±è¢«é”€æ¯ï¼Œä½†æ˜¯è¿”å›çš„`lambda`è¡¨è¾¾å¼å´å¼•ç”¨äº†è¯¥å˜é‡ï¼Œä½†è°ƒç”¨è¿™ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œå¼•ç”¨çš„æ˜¯ä¸€ä¸ªåƒåœ¾å€¼ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿæ²¡æœ‰æ„ä¹‰çš„ç»“æœã€‚å¦‚æœé€šè¿‡ä¼ å€¼çš„æ–¹å¼æ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼š

```cpp
std::function<int(int)> add_x(int x)
{
    return [=](int a) { return x + a; };
}
```

ä½¿ç”¨é»˜è®¤ä¼ å€¼æ–¹å¼å¯ä»¥é¿å…æ‚¬æŒ‚å¼•ç”¨é—®é¢˜ã€‚ä½†æ˜¯é‡‡ç”¨é»˜è®¤å€¼æ•è·æ‰€æœ‰å˜é‡ä»ç„¶æœ‰é£é™©ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```cpp
class Filter
{
public:
    Filter(int divisorVal) : divisor(divisorVal){}

    std::function<bool(int)> getFilter() 
    {
        return [=](int value) {return value % divisor == 0; };
    }

private:
    int divisor;
};
```

è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜æ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª`lambda`è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä½¿ç”¨äº†ç±»çš„æ•°æ®æˆå‘˜`divisor`ã€‚è€Œä¸”é‡‡ç”¨é»˜è®¤å€¼æ–¹å¼æ•æ‰æ‰€æœ‰å˜é‡ã€‚ä½ å¯èƒ½è®¤ä¸ºè¿™ä¸ª`lambda`è¡¨è¾¾å¼ä¹Ÿæ•æ‰äº†`divisor`çš„ä¸€ä»½å‰¯æœ¬ï¼Œä½†æ˜¯å®é™…ä¸Šå¤§é”™ç‰¹é”™ã€‚é—®é¢˜å‡ºç°åœ¨å“ªé‡Œå‘¢ï¼Ÿå› ä¸ºæ•°æ®æˆå‘˜`divisor`å¯¹`lambda`è¡¨è¾¾å¼å¹¶ä¸å¯è§ï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç éªŒè¯ï¼š

```cpp
// ç±»çš„æ–¹æ³•ï¼Œä¸‹é¢æ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºdivisorå¹¶ä¸åœ¨lambdaæ•æ‰çš„èŒƒå›´
std::function<bool(int)> getFilter() 
{
    return [divisor](int value) {return value % divisor == 0; };
}
```

é‚£ä¹ˆåŸæ¥çš„ä»£ç ä¸ºä»€ä¹ˆèƒ½å¤Ÿæ•æ‰åˆ°å‘¢ï¼Ÿä»”ç»†æƒ³æƒ³ï¼ŒåŸæ¥æ¯ä¸ªéé™æ€æ–¹æ³•éƒ½æœ‰ä¸€ä¸ª`this`æŒ‡é’ˆå˜é‡ï¼Œåˆ©ç”¨`this`æŒ‡é’ˆï¼Œä½ å¯ä»¥æ¥è¿‘ä»»ä½•æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥`lambda`è¡¨è¾¾å¼å®é™…ä¸Šæ•æ‰çš„æ˜¯`this`æŒ‡é’ˆçš„å‰¯æœ¬ï¼Œæ‰€ä»¥åŸæ¥çš„ä»£ç ç­‰ä»·äºï¼š

```cpp
std::function<bool(int)> getFilter() 
{
    return [this](int value) {return value % this->divisor == 0; };
}
```

å°½ç®¡è¿˜æ˜¯ä»¥å€¼æ–¹å¼æ•è·ï¼Œä½†æ˜¯æ•è·çš„æ˜¯æŒ‡é’ˆï¼Œå…¶å®ç›¸å½“äºä»¥å¼•ç”¨çš„æ–¹å¼æ•è·äº†å½“å‰ç±»å¯¹è±¡ï¼Œæ‰€ä»¥`lambda`è¡¨è¾¾å¼çš„é—­åŒ…ä¸ä¸€ä¸ªç±»å¯¹è±¡ç»‘å®šåœ¨ä¸€èµ·äº†ï¼Œè¿™ä¹Ÿå¾ˆå±é™©ï¼Œå› ä¸ºä½ ä»ç„¶æœ‰å¯èƒ½åœ¨ç±»å¯¹è±¡ææ„åä½¿ç”¨è¿™ä¸ª`lambda`è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆç±»ä¼¼â€œæ‚¬æŒ‚å¼•ç”¨â€çš„é—®é¢˜ä¹Ÿä¼šäº§ç”Ÿã€‚æ‰€ä»¥ï¼Œé‡‡ç”¨é»˜è®¤å€¼æ•æ‰æ‰€æœ‰å˜é‡ä»ç„¶æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸»è¦æ˜¯ç”±äºæŒ‡é’ˆå˜é‡çš„å¤åˆ¶ï¼Œå®é™…ä¸Šè¿˜æ˜¯æŒ‰å¼•ç”¨ä¼ å€¼ã€‚

### ğŸ–‹ 1.3ã€å‚æ•°

* å‚æ•°åˆ—è¡¨ä¸­ä¸èƒ½æœ‰é»˜è®¤å‚æ•°
* ä¸æ”¯æŒå¯å˜å‚æ•°
* æ‰€æœ‰å‚æ•°å¿…é¡»æœ‰å‚æ•°å

### ğŸ–‹ 1.4ã€è¿”å›ç±»å‹

å•ä¸€çš„returnè¯­å¥å¯ä»¥æ¨æ–­è¿”å›ç±»å‹ï¼›å¤šè¯­å¥åˆ™é»˜è®¤è¿”å›voidï¼Œå¦åˆ™æŠ¥é”™ï¼Œåº”æŒ‡å®šè¿”å›ç±»å‹ã€‚

```cpp
// æ­£ç¡®ï¼Œå•ä¸€returnè¯­å¥
transform(vi.begin(),vi.end(),vi.begin(), 
    [] (int i) { 
    return i<0? -i; i;
    }
);
// é”™è¯¯ã€‚ä¸èƒ½æ¨æ–­è¿”å›ç±»å‹
transform(vi.begin(),vi.end(),vi.begin(), 
    [] (int i) { 
        if (I<0) return -i;
        else return i;
    }
);
// æ­£ç¡®ï¼Œå°¾ç½®è¿”å›ç±»å‹
transform(vi.begin(),vi.end(),vi.begin(), 
    [] (int i) ->int{ 
        if (I<0) 
            return -i;
        else 
            return i;
    }
);
```

### ğŸ–‹ 1.5ã€èµ‹å€¼

å¯ä»¥ä½¿ç”¨auto å’Œfunction æ¥å—lambdaè¡¨è¾¾å¼çš„è¿”å›ï¼š

```cpp
int x = 8, y = 9;
auto add = [](int a, int b) { return a + b; };
std::function<int(int, int)> Add = [=](int a, int b) { return a + b; };

cout << "add: " << add(x, y) << endl; // 17
cout << "Add: " << Add(x, y) << endl; // 17
```

lambdaè¡¨è¾¾å¼äº§ç”Ÿçš„ç±»ä¸å«æœ‰é»˜è®¤æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦ã€é»˜è®¤ææ„å‡½æ•°ã€‚è‡³äºé—­åŒ…ç±»ä¸­æ˜¯å¦æœ‰å¯¹åº”æˆå‘˜ï¼Œ`C++`æ ‡å‡†ä¸­ç»™å‡ºçš„ç­”æ¡ˆæ˜¯ï¼šä¸æ¸…æ¥šçš„ï¼Œçœ‹æ¥ä¸å…·ä½“å®ç°æœ‰å…³ã€‚è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼š`lambda`è¡¨è¾¾å¼æ˜¯ä¸èƒ½è¢«èµ‹å€¼çš„ï¼š

```cpp
auto a = [] { cout << "A" << endl; };
auto b = [] { cout << "B" << endl; };

a = b;   // éæ³•ï¼Œlambdaæ— æ³•èµ‹å€¼
auto c = a;   // åˆæ³•ï¼Œç”Ÿæˆä¸€ä¸ªå‰¯æœ¬
```

å› ä¸ºç¦ç”¨äº†èµ‹å€¼æ“ä½œç¬¦ï¼š

```cpp
ClosureType& operator=(const ClosureType&) = delete;
```

ä½†æ˜¯æ²¡æœ‰ç¦ç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ª`lambda`è¡¨è¾¾å¼å»åˆå§‹åŒ–å¦å¤–ä¸€ä¸ª`lambda`è¡¨è¾¾å¼è€Œäº§ç”Ÿå‰¯æœ¬ã€‚å¹¶ä¸”`lambda`è¡¨è¾¾å¼ä¹Ÿå¯ä»¥èµ‹å€¼ç»™ç›¸å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¹Ÿä½¿å¾—ä½ å®Œå…¨å¯ä»¥æŠŠ`lambda`è¡¨è¾¾å¼çœ‹æˆå¯¹åº”**å‡½æ•°ç±»å‹çš„æŒ‡é’ˆ**ã€‚

### ğŸ–‹ 1.6ã€æ–°ç‰¹æ€§

 åœ¨`C++14`ä¸­ï¼Œ`lambda`åˆå¾—åˆ°äº†å¢å¼ºï¼Œä¸€ä¸ªæ˜¯æ³›å‹`lambda`è¡¨è¾¾å¼ï¼Œä¸€ä¸ªæ˜¯`lambda`å¯ä»¥æ•æ‰è¡¨è¾¾å¼ã€‚

#### lambdaæ•æ‰è¡¨è¾¾å¼

`lambda`è¡¨è¾¾å¼å¯ä»¥æŒ‰å¤åˆ¶æˆ–è€…å¼•ç”¨æ•è·åœ¨å…¶ä½œç”¨åŸŸèŒƒå›´å†…çš„å˜é‡ã€‚è€Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›æ•æ‰ä¸åœ¨å…¶ä½œç”¨åŸŸèŒƒå›´å†…çš„å˜é‡ï¼Œè€Œä¸”æœ€é‡è¦çš„æ˜¯æˆ‘ä»¬å¸Œæœ›æ•æ‰å³å€¼ã€‚æ‰€ä»¥`C++14`ä¸­å¼•å…¥äº†è¡¨è¾¾å¼æ•æ‰ï¼Œå…¶å…è®¸ç”¨ä»»ä½•ç±»å‹çš„è¡¨è¾¾å¼åˆå§‹åŒ–æ•æ‰çš„å˜é‡ï¼š

```cpp
// åˆ©ç”¨è¡¨è¾¾å¼æ•è·ï¼Œå¯ä»¥æ›´çµæ´»åœ°å¤„ç†ä½œç”¨åŸŸå†…çš„å˜é‡
int x = 4;
auto y = [&r = x, x = x + 1] { r += 2; return x * x; }();
// æ­¤æ—¶ x æ›´æ–°ä¸º6ï¼Œy ä¸º25

// ç›´æ¥ç”¨å­—é¢å€¼åˆå§‹åŒ–å˜é‡
auto z = [str = "string"]{ return str; }();
// æ­¤æ—¶zæ˜¯const char* ç±»å‹ï¼Œå­˜å‚¨å­—ç¬¦ä¸² string
```

å¯ä»¥çœ‹åˆ°æ•æ‰è¡¨è¾¾å¼æ‰©å¤§äº†`lambda`è¡¨è¾¾å¼çš„æ•æ‰èƒ½åŠ›ï¼Œæœ‰æ—¶å€™ä½ å¯ä»¥ç”¨`std::move`åˆå§‹åŒ–å˜é‡ã€‚è¿™å¯¹ä¸èƒ½å¤åˆ¶åªèƒ½ç§»åŠ¨çš„å¯¹è±¡å¾ˆé‡è¦ï¼Œæ¯”å¦‚`std::unique_ptr`ï¼Œå› ä¸ºå…¶ä¸æ”¯æŒå¤åˆ¶æ“ä½œï¼Œä½ æ— æ³•ä»¥å€¼æ–¹å¼æ•æ‰åˆ°å®ƒã€‚ä½†æ˜¯åˆ©ç”¨`lambda`æ•æ‰è¡¨è¾¾å¼ï¼Œå¯ä»¥é€šè¿‡ç§»åŠ¨æ¥æ•æ‰å®ƒï¼š

```cpp
auto myPi = std::make_unique<double>(3.1415);

auto circle_area = [pi = std::move(myPi)](double r) { return *pi * r * r; };
cout << circle_area(1.0) << endl; // 3.1415
```

 å…¶å®ç”¨è¡¨è¾¾å¼åˆå§‹åŒ–æ•æ‰å˜é‡ï¼Œä¸ä½¿ç”¨`auto`å£°æ˜ä¸€ä¸ªå˜é‡çš„æœºç†æ˜¯ç±»ä¼¼çš„ã€‚

#### æ³›å‹lambdaè¡¨è¾¾å¼

ä»`C++14`å¼€å§‹ï¼Œ`lambda`è¡¨è¾¾å¼æ”¯æŒæ³›å‹ï¼šå…¶å‚æ•°å¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ¨æ–­ç±»å‹çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦æ˜¾ç¤ºåœ°å£°æ˜å…·ä½“ç±»å‹ã€‚è¿™å°±å¦‚åŒå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå‚æ•°è¦ä½¿ç”¨ç±»å‹è‡ªåŠ¨æ¨æ–­åŠŸèƒ½ï¼Œåªéœ€è¦å°†å…¶ç±»å‹æŒ‡å®šä¸º`auto`ï¼Œç±»å‹æ¨æ–­è§„åˆ™ä¸å‡½æ•°æ¨¡æ¿ä¸€æ ·ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç®€å•ä¾‹å­ï¼š

```cpp
auto add = [](auto x, auto y) { return x + y; };

int x = add(2, 3);   // 5
double y = add(2.5, 3.5);  // 6.0
```

### ğŸ–‹ 1.7ã€Lambdaä¸`STL`

`lambda`è¡¨è¾¾å¼å¯ä»¥èµ‹å€¼ç»™å¯¹åº”ç±»å‹çš„å‡½æ•°æŒ‡é’ˆã€‚ä½†æ˜¯ä½¿ç”¨å‡½æ•°æŒ‡é’ˆè²Œä¼¼å¹¶ä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿ã€‚æ‰€ä»¥`STL`å®šä¹‰åœ¨`<functional>`å¤´æ–‡ä»¶æä¾›äº†ä¸€ä¸ªå¤šæ€çš„å‡½æ•°å¯¹è±¡å°è£…`std::function`ï¼Œå…¶ç±»ä¼¼äºå‡½æ•°æŒ‡é’ˆã€‚å®ƒå¯ä»¥ç»‘å®šä»»ä½•ç±»å‡½æ•°å¯¹è±¡ï¼Œåªè¦å‚æ•°ä¸è¿”å›ç±»å‹ç›¸åŒã€‚å¦‚ä¸‹é¢çš„è¿”å›ä¸€ä¸ªboolä¸”æ¥æ”¶ä¸¤ä¸ªintçš„å‡½æ•°åŒ…è£…å™¨ï¼š

```cpp
std::function<bool(int, int)> wrapper = [](int x, int y) { return x < y; };
```

è€Œ`lambda`è¡¨è¾¾å¼ä¸€ä¸ªæ›´é‡è¦çš„åº”ç”¨æ˜¯å…¶å¯ä»¥ç”¨äºå‡½æ•°çš„å‚æ•°ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å®ç°å›è°ƒå‡½æ•°ã€‚å…¶å®ï¼Œæœ€å¸¸ç”¨çš„æ˜¯åœ¨`STL`ç®—æ³•ä¸­ï¼Œæ¯”å¦‚ä½ è¦ç»Ÿè®¡ä¸€ä¸ªæ•°ç»„ä¸­æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å…ƒç´ æ•°é‡ï¼Œé€šè¿‡`lambda`è¡¨è¾¾å¼ç»™å‡ºæ¡ä»¶ï¼Œä¼ é€’ç»™`count_if`å‡½æ•°ï¼š

```cpp
int value = 3;
vector<int> v {1, 3, 5, 2, 6, 10};

int count = std::count_if(v.beigin(), v.end(), [value](int x) { return x > value; });
```

å†æ¯”å¦‚ä½ æƒ³ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œç„¶åä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæ­¤æ—¶ä½ å¯ä»¥ä½¿ç”¨`generate`å‡½æ•°ï¼Œå¹¶è¾…åŠ©`lambda`è¡¨è¾¾å¼ï¼š

```cpp
vector<int> v(10);
int a = 0;
int b = 1;

std::generate(v.begin(), v.end(), [&a, &b] { int value = b; b = b + a; a = value; return value; });
// æ­¤æ—¶v {1, 1, 2, 3, 5, 8, 13, 21, 34, 55}
```

æ­¤å¤–ï¼Œ`lambda`è¡¨è¾¾å¼è¿˜ç”¨äºå¯¹è±¡çš„æ’åºå‡†åˆ™ï¼š

```cpp
class Person
{
public:
    Person(const string& first, const string& last):
        firstName(first), lastName(last) {}

    Person() = default;

    string first() const { return firstName; }
    string last() const { return lastName; }
private:
    string firstName;
    string lastName;
};

int main()
{
    vector<Person> vp;
    // æ·»åŠ Personä¿¡æ¯
    ...
    // æŒ‰ç…§å§“åæ’åº
    std::sort(vp.begin(), vp.end(), [](const Person& p1, const Person& p2)
    { return p1.last() < p2.last() || (p1.last() == p2.last() && p1.first() < p2.first()); });

    return 0;
}
```

æ€»ä¹‹ï¼Œå¯¹äºå¤§éƒ¨åˆ†`STL`ç®—æ³•ï¼Œå¯ä»¥éå¸¸çµæ´»åœ°æ­é…`lambda`è¡¨è¾¾å¼æ¥å®ç°æƒ³è¦çš„æ•ˆæœã€‚

## âœ 2ã€Lambdaä¸é€’å½’

å¯¹äºä¸€ä¸ªæ±‚è‡ªç„¶æ•°1-Nå’Œçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºä»¥ä¸‹é€’å½’å…¬å¼ï¼š

```cpp
f(n) = n == 1 ? 1 : n + f(n - 1);
```

è‹¥æƒ³ä½¿ç”¨C++lambdaè¡¨è¾¾å¼å®ç°ä¸Šè¿°è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°†å…¶æ”¹å†™ä¸ºä»¥ä¸‹ä»£ç ï¼š

```cpp
const auto& f = [](const int& n) {
	return n == 1 ? 1 : n + f(n - 1);
};
```

å‘ç°ç¼–è¯‘æ— æ³•é€šè¿‡ã€‚

### ğŸ–‹ 2.1ã€ä½¿ç”¨std::function

std::functionå¯ä»¥æŠŠlambdaåŒ…è£…èµ·æ¥ï¼Œç›¸å½“äºèµ‹äºˆäº†å…¶ä¸€ä¸ªå‡½æ•°åï¼Œåœ¨é€šè¿‡å¼•ç”¨æ•è·å¹¶å®ç°é€’å½’è°ƒç”¨ï¼Œå®ç°å¦‚ä¸‹ï¼š

```cpp
const auto& sum = [](const int& n) {
		std::function<int(const int&)> s;
		s = [&](const int& n) {
			  return n == 1 ? 1 : n + s(n - 1);
		};
		return s(n);
};

std::cout << sum(100);
```

### ğŸ–‹ 2.2ã€å°†lambdaä½œä¸ºå‚æ•°

```cpp
const auto& sum = [](const int& n) {
		const auto& s = [&](auto&& self, const int& x) -> int {
			  return x == 1 ? 1 : x + self(self, x - 1);
		};
		return s(s, n);
};

std::cout << sum(100);
```

### ğŸ–‹ 2.3ã€å‡½æ•°æŒ‡é’ˆ

{% tabs %}
{% tab title="C++14" %}
```cpp
auto sum = std::make_shared<std::unique_ptr< std::function<int(int)> >>();
*sum = std::make_unique<std::function<int(int)>>(
    [=](int n) {
        return n == 1 ? 1 : n + (**sum)(n - 1);
    }
);

std::cout << (**sum)(100);
```
{% endtab %}

{% tab title="C++11" %}
```cpp
auto sum = std::shared_ptr<std::unique_ptr< std::function<int(int)> >>
    (new std::unique_ptr< std::function<int(int)> >());
*sum = std::unique_ptr<std::function<int(int)>>(
    new std::function<int(int)>(
        [=](int n) {
            return n == 1 ? 1 : n + (**sum)(n - 1);
        }
    )
);

std::cout << (**sum)(100);
```
{% endtab %}
{% endtabs %}

### ğŸ–‹ 2.4ã€ä½¿ç”¨Yç»„åˆå­

æ„é€ ä¸€ä¸ªYç»„åˆå­å¦‚ä¸‹ï¼š

```cpp
const auto& y = [](const auto& f) {
	  return [&](const auto& x) {
		    return x(x);
	  }([&](const auto& x) -> std::function<int(int)> {
		    return f([&](const int& n) {
			      return x(x)(n);
		    });
	  });
};
```

å†å®ç°ä¸€ä¸ªæ±‚å’Œå‡½æ•°çš„é«˜é˜¶å‡½æ•°ï¼Œç„¶åè¿æ¥å³å¯ï¼š

```cpp
const auto& sum = [](const auto& f) {
		return [=](const int& n) {
			  return n == 1 ? 1 : n + f(n - 1);
		};
};

std::cout << y(sum)(100);
```

